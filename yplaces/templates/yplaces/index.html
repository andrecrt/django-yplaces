{% extends 'yplaces/base.html' %}

{% load i18n %}

{% load staticfiles %}

{% block title %}{{ title }}{% endblock %}

{% block description %}{{ description }}{% endblock %}

{% block head %}
  <link href="{% static 'yplaces/css/index.css' %}" rel="stylesheet">
{% endblock %}

{% block body %}

<div class="map-container">
  <div id="map">
    <i class="fa fa-map-marker fa-5x"></i>
    <br>
    {% trans 'Loading Map' %}
    <br>
    <img src="{% static 'yplaces/images/ajax-loader-16x16.gif' %}">
  </div>
  <div class="overlay">
    <div class="background"></div>
    <div class="content">
      <h1 style="margin: 0; padding: 0;">{% trans 'Nearby Places' %}</h1>
      <p style="font-size: 10pt;">{% trans 'Drag the marker to find places near its location!' %}</p>
      <div class="results">
        <table class="table table-hover"><tbody></tbody></table>
      </div>
      <div class="no-results">
        {% trans 'No results found near that location' %}
        <p>:(</p>
      </div>
      <div class="loading">
        <img src="http://brilliancerealtygroup.com/wp-content/themes/BRG/images/common/ajax-loader.gif">
      </div>
      </p>
    </div>
  </div>
</div>

{% endblock %}

{% block javascript %}
  <script src="http://maps.google.com/maps/api/js?libraries=geometry&sensor=false"></script>
  <script src="{% static 'yplaces/js/index.js' %}"></script>
  <script>
      /*
       * Assorted variables.
       */
      var map;
      var marker;
      var places = [];
      var infowindow;
      var places_api_url = '{{ places_api_url }}';
      var static_url = '{{ STATIC_URL }}';
      var place_href = "{% url 'yplaces:slug' pk=1 slug="place-slug" %}";

      /*
       * What to do after page finishes loading.
       */
      $(document).ready(function() {

  	      // Fetch user's location based on the IP address and initialize map.
  	      $.getJSON('http://www.openlinkmap.org/api/ippos.php?format=json&callback=?', function(data, status, xhr) {
              initializeMap(data.lat, data.lon, true);
          });
      });
  </script>
{% endblock %}